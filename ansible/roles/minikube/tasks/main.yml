---
# tasks file for ansible-role
- name: install updates for CentOS
  tags: always
  yum: 
    update_only: yes
    update_cache: yes

- name: downloading minikube
  become: true
  tags: minikube
  get_url:
    url: '{{ minikube_url }}'
    dest: '{{ minikube_install_target }}'
    mode: 0755

    #- name: linking {{ minikube_install_link }} to {{ minikube_install_target }}
    #become: yes
    #become_user: root
    #tags: minikube
    #file:
    #src: '{{ minikube_install_target }}'
    #dest: '{{ minikube_install_target }}'
    #state: link
- name: install minikube kvm drivers
  become: true
  tags: minikube
  yum: 
    name: 
      - libvirt
      - qemu-kvm
      - libvirt-python
      - libguestfs-tools
      - bridge-utils

- name: start virtualization service
  become: true
  service:
    name: libvirtd
    state: started

- name: installing minikubqwee
  become: true 
  command: curl -LO https://dl.k8s.io/release/v1.22.0/bin/linux/amd64/kubectl && install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

- name: installing minikube
  become: true
  tags: minikube
  command: install {{ minikube_install_target }} {{ minikube_install_link }}
